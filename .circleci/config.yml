version: 2
orbs:
  orb-docs:
    executors:
      hugo:
        docker:
          - image: cibuilds/hugo:latest
    commands:
      install-circleci-cli:
        parameters:
          root-url:
            description: the root URL used to generate the download link. You almost certainly can rely on the default value.
            type: string
            default: "https://github.com/CircleCI-Public/circleci-cli/releases/download/"
        steps:
          - run:
              name: "Install `circleci` CLI"
              command: |
                echoerr ()
                {
                    echo "$@" >&2
                }
                if [ $(uname) == "Darwin" ]; then
                  OS=darwin
                elif [ $(expr substr $(uname -s) 1 5) == "Linux" ]; then
                  OS=linux
                else
                  echoerr "This installer is only supported on Linux and MacOS"
                  exit 1
                fi
                ARCH="$(uname -m)"
                if [ $ARCH == "x86_64" ]; then
                  ARCH=amd64
                elif [[ $ARCH == arm* ]]; then
                  ARCH=arm
                else
                  echoerr "This installer does not support your architecture: $ARCH"
                  exit 1
                fi
                CIRCLECI_CLI_LATEST_VERSION=`curl --silent "https://api.github.com/repos/CircleCI-Public/circleci-cli/releases/latest" | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/'`
                download_url=<< parameters.root-url >>${CIRCLECI_CLI_LATEST_VERSION}/circleci-cli_${CIRCLECI_CLI_LATEST_VERSION#v}_${OS}_${ARCH}.tar.gz
                curl -L ${download_url} | tar -xvzf -
                mv circleci /usr/local/bin
                circleci help
jobs:
  build:
    executor: orb-docs/hugo
    steps:
      - orb-docs/install-circleci-cli



version: 2
orbs:
  orb-docs:
    executors:
      hugo:
        docker:
          - image: cibuilds/hugo:latest
    commands:
      latest-cli-version:
        parameters:
          var-name: 
            description:
                "The name of an environment variable to store the version in.
                Defaults to CIRCLECI_CLI_LATEST_VERSION"
            default: CIRCLECI_CLI_LATEST_VERSION
            type: string
        steps:
          - run:
              name: "Save latest CircleCI CLI release version to an environment variable"
              command: |
                export << parameters.var-name >>=`curl --silent "https://api.github.com/repos/CircleCI-Public/circleci-cli/releases/latest" | grep -Po '"tag_name": "\K.*?(?=")'`
                echo $<< parameters.var-name >>
      install-circleci-cli:
        steps:
          - run:
              name: "Install circleci CLI"
              command: |
                echoerr() { echo "\$@" 1>&2; }
                if [ "\$(uname)" == "Darwin" ]; then
                  OS=darwin
                elif [ "\$(expr substr \$(uname -s) 1 5)" == "Linux" ]; then
                  OS=linux
                else
                  echoerr "This installer is only supported on Linux and MacOS"
                  exit 1
                fi
                echo $OS
jobs:
  build:
    executor: orb-docs/hugo
    steps:
      - orb-docs/latest-cli-version
      - orb-docs/install-circleci-cli


